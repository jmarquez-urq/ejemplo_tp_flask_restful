<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>Guardar enlace</title>
    </head>
    <body>
        <h1>Guardar enlace</h1>
        <form id="form_enlace" onsubmit="guardar_enlace(event)">
           <label for="url">URL</label>
           <input name="url" id="url"><br>

           <label for="titulo">Título</label>
           <input name="titulo" id="titulo"><br>

           <label for="descripcion">Descripción</label>
           <input name="descripcion" id="descripcion"><br>

           <input type="submit" name="guardar" id="guardar" value="Guardar">
        </form>
        <div id="resultado"></div>
<script>
function guardar_enlace(e)
{
    e.preventDefault();

    // Recuperar el token JWT
    const token = localStorage.getItem('access_token');
    if (!token) {
        alert("Esta página es solamente para usuarios");
        window.location.href = "/";
        return;
    }

    // Guardamos en constantes los datos ingresados en el formulario
    const url = document.querySelector('#url').value;
    const titulo = document.querySelector('#titulo').value;
    const descripcion = document.querySelector('#descripcion').value;

    // Hacemos fetch por POST, con autenticación y los datos en body:
    fetch ('/links', {
        "method": "POST",
        "headers": {
            'Content-Type' : 'application/json',
            'Authorization': `Bearer ${token}`
        },
        "body": JSON.stringify({url, titulo, descripcion})
    })
    .then( respuesta => respuesta.json() )
    .then(resultado_enlace => document.querySelector('#resultado').textContent = resultado_enlace.message)
    .catch( e => { console.log(e);});
}
</script>
    </body>
</html>
